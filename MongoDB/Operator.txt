helm repo add mongodb https://mongodb.github.io/helm-charts
helm repo update

helm install mongodb-kubernetes-operator mongodb/mongodb-kubernetes \
  --namespace mongodb-operator \
  --create-namespace

kubectl get pods -n mongodb-operator

kubectl create namespace mongodb

kubectl create secret generic tomas   --from-literal=password='tomas'   -n mongodb


apiVersion: mongodbcommunity.mongodb.com/v1
kind: MongoDBCommunity
metadata:
  name: mongodb-cluster
  namespace: mongodb
spec:
  members: 3
  type: ReplicaSet
  version: "6.0.0"

  security:
    authentication:
      modes: ["SCRAM"]

  users:
    - name: tomas
      db: admin
      passwordSecretRef:
        name: tomas   # <-- il secret che hai creato
      roles:
        - name: clusterAdmin
          db: admin
        - name: userAdminAnyDatabase
          db: admin

  statefulSet:
    spec:
      serviceName: "mongodb-cluster"
      replicas: 3
      selector:
        matchLabels:
          app: mongodb-cluster
      template:
        metadata:
          labels:
            app: mongodb-cluster
        spec:
          containers:
          - name: mongod
            image: mongo:6.0
            command:
              - mongod
              - "--replSet"
              - "rs0"
              - "--bind_ip_all"
            ports:
              - containerPort: 27017
            volumeMounts:
              - name: data
                mountPath: /data/db
          volumes:
            - name: data
              emptyDir: {}



kubectl apply -f mongodb-cluster.yaml



kubectl autoscale statefulset mongodb-cluster \
  --cpu-percent=80 \
  --min=3 \
  --max=6 \
  --namespace=mongodb


kubectl get mongodbcommunity -n mongodb



kubectl describe mongodbcommunity mongodb-cluster -n mongodb


